# Get notification of activity in another window
setw -g monitor-activity on
set -g visual-activity on

# Shortcut for toggling monitor-activity and monitor-silence
bind-key g setw monitor-activity

# UTF-8
setw -g utf8 on
set-window-option -g utf8 on
set -g status-utf8 on

# Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Use Alt-Shift J/K to move through windows
bind -n M-J next-window
bind -n M-K previous-window

# Sessions
bind P source-file ~/.tmux/pdev

# Use ` as the prefix key and C-a as the secondary prefix key
unbind C-b
set -g prefix `
bind ` send-prefix
set -g prefix2 C-a
bind C-a send-prefix -2

# look good
set -g default-terminal "screen-256color"

# fix scrolling
set -g terminal-overrides 'xterm*:smcup@:rmcup@'

# Clear scrollback buffer
bind C-l clear-history \; display-message "Cleared scrollback history"

# Create non-login shells by default
set -g default-command "$SHELL -i"

# Extend history limit
set -g history-limit 10000

# First terminal is 1, not 0
set -g base-index 1

# First pane is 1
set-window-option -g pane-base-index 1

# Timeout for pane numbers
set -g display-panes-time 2500

# Use r to reload from tmux.conf
bind r source-file ~/.tmux.conf \; display-message "Config Reloaded!"

# Use R to renumber windows in the current session
bind R move-window -r \; display-message "Renumbered windows to be gapless"

# Prompt for hostname and create window to it
bind-key S command-prompt -p ssh: "new-window -n %1 'ssh %1'"

# Prompt for a window and join that window to this one
bind-key V choose-window 'join-pane -h -s "%%"'
bind-key @ command-prompt -p "create pane and join from:" "join-pane -h -s ':%%'"

# Prompt for session and attach to it:
bind-key s choose-session

bind P swap-window -t -1
bind N swap-window -t +1

bind-key H command-prompt -p 'save history to filename:' -I '~/tmux.history' 'capture-pane -e -S -32768 ; save-buffer %1 ; delete-buffer'
bind-key M-H command-prompt -p 'Save history to logs:' -I "~/logs/%Y%m%d-%H%M%Z-#S-#W-#T.history" 'capture-pane -e -S -32768 ; save-buffer %1 ; delete-buffer'

# Switch between the last window quickly
bind-key \; last-window

# Aggressively resize windows so that when multiple clients are connected to the same
# session, the window size will be constrained to the size of the smallest client only
# if both sessions are actively looking at the same window
set -g aggressive-resize off

# Synchronize two panes
#bind s set -g synchronize-panes

# Scroll your way into copy mode (scrollback buffer)
# and select text for copying with the mouse
setw -g mouse on

setw -g mode-keys vi
unbind-key h
bind h select-pane -L
unbind-key j
bind j select-pane -D
unbind-key k
bind k select-pane -U
unbind-key l
bind l select-pane -R

bind-key -t vi-copy 'v' begin-selection
bind-key -t vi-copy 'y' copy-selection
bind-key y run-shell -b "tmux show-buffer \| xclip -selection clipboard -i"
# Doesn't work with Tmux 1.8
#bind-key -t vi-copy 'y' run-shell -b "tmux show-buffer | xclip -selection clipboard -i"

# Set status background and foreground colours, along with other text settings
set -g status-fg white
set -g status-bg colour234
set -g window-status-activity-attr bold
set -g pane-border-fg colour245
set -g pane-active-border-fg colour39
set -g message-fg colour16
set -g message-bg colour221
set -g message-attr bold
set -g status-left-length 32
set -g status-right-length 150

# set the formatting of the status line and of the window names
# #S - session name, #h hostname (no domain), #I current window index, #W current window name
set -g status-left '#[fg=colour148,bold]#h:#S#[default] -'
set -g status-right '#[fg=colour148,nobold]%Y-%m-%d %H:%M'
set -g window-status-format "#[fg=white,bg=colour234] #I #W:#10T "
set -g window-status-current-format "#[fg=colour234,bg=colour148]#[fg=colour232,bg=colour148,noreverse,bold] #I #W:#10T #[fg=colour148,bg=colour234,nobold]"

unbind +
bind + \
  new-window -d -n tmux-zoom 'clear && echo TMUX ZOOM && read' \;\
  swap-pane -s tmux-zoom.0 \;\
  select-window -t tmux-zoom

unbind -
bind - \
  last-window \;\
  swap-pane -s tmux-zoom.0 \;\
  kill-window -t tmux-zoom

# Load any local configuration
if-shell "test -f ~/.tmux.conf.local" "source-file ~/.tmux.conf.local"

