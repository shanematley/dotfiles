#!/usr/bin/env bash

# waits for a PID to exit before continuing. It also keeps the system from
# going to sleep.
# Samples:
# - I want to start something only after another process finishes
#   waitfor 1234 ; something_else
# - I started a long-running process and want to know when it's done
#   waitfor 1234 ; notify 'process 1234 is done'

set -e
set -u
set -o pipefail

pid="$1"

if hash caffeinate 2>/dev/null; then
  caffeinate -w "$pid"
elif hash systemd-inhibit 2>/dev/null; then
  systemd-inhibit \
    --who=waitfor \
    --why="Awaiting PID $pid" \
    tail --pid="$pid" -f /dev/null
else
  tail --pid="$pid" -f /dev/null
fi

